# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ / Architecture

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Browser                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Environment Detection        â”‚
        â”‚   (Azure / Local)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                               â”‚
         â†“                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Azure Easy Authâ”‚           â”‚  MSAL Library   â”‚
â”‚  (Production)   â”‚           â”‚  (Development)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Access Token    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Streamlit App     â”‚
            â”‚  (app.py)          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  SharePoint Client â”‚
            â”‚  (Graph API)       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Microsoft Graph API    â”‚
         â”‚  (graph.microsoft.com)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  SharePoint Online      â”‚
         â”‚  (Files & Folders)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (`app.py`)

**è²¬ä»»**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æä¾›
- ç’°å¢ƒæ¤œå‡ºï¼ˆAzure vs ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
- èªè¨¼ãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡
- ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®è¡¨ç¤º

**ä¸»è¦æ©Ÿèƒ½**:
- `is_running_on_azure()`: å®Ÿè¡Œç’°å¢ƒã‚’åˆ¤å®š
- `get_access_token()`: ç’°å¢ƒã«å¿œã˜ãŸèªè¨¼æ–¹æ³•ã‚’é¸æŠ
- `display_file_list()`: ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’è¡¨ç¤º
- `main()`: ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯

### 2. èªè¨¼å±¤ (`auth/`)

#### 2.1 Azure Easy Auth (`auth/azure_auth.py`)

**è²¬ä»»**:
- Azure App Serviceã®Easy Authã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—

**ä¸»è¦æ©Ÿèƒ½**:
- `get_azure_easyauth_token()`: Easy Authãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
- `get_user_info_from_easyauth()`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—

**å‹•ä½œãƒ•ãƒ­ãƒ¼**:
```
1. Easy AuthãŒè‡ªå‹•çš„ã«èªè¨¼ã‚’å‡¦ç†
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
   - X-MS-TOKEN-AAD-ACCESS-TOKEN
3. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”å´
```

#### 2.2 MSALèªè¨¼ (`auth/msal_auth.py`)

**è²¬ä»»**:
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã®å¯¾è©±å‹èªè¨¼
- ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

**ä¸»è¦æ©Ÿèƒ½**:
- `init_msal_app()`: MSAL PublicClientApplicationã®åˆæœŸåŒ–
- `get_msal_token()`: å¯¾è©±å‹èªè¨¼ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
- `get_msal_token_with_client_secret()`: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—

**å‹•ä½œãƒ•ãƒ­ãƒ¼**:
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒSign Inã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. MSALãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒMicrosoftã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
4. èªè¨¼å®Œäº†å¾Œã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
5. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆã«ä¿å­˜
```

### 3. Graph APIå±¤ (`graph/`)

#### 3.1 SharePointã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (`graph/sharepoint_client.py`)

**è²¬ä»»**:
- Microsoft Graph APIã¨ã®é€šä¿¡
- SharePointã‚µã‚¤ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®æ“ä½œ

**ä¸»è¦æ©Ÿèƒ½**:
- `get_site_id_by_url()`: SharePointã‚µã‚¤ãƒˆã®IDã‚’å–å¾—
- `list_files()`: ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸€è¦§ã‚’å–å¾—
- `get_file_content()`: ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- `search_files()`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢

**Graph APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
- ã‚µã‚¤ãƒˆå–å¾—: GET /sites/{hostname}:{site-path}
- ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§: GET /sites/{site-id}/drive/root/children
- ãƒ•ã‚©ãƒ«ãƒ€å†…ä¸€è¦§: GET /sites/{site-id}/drive/root:/{path}:/children
- ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢: GET /sites/{site-id}/drive/root/search(q='{query}')
- ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—: GET /sites/{site-id}/drive/root:/{path}:/content
```

## èªè¨¼ãƒ•ãƒ­ãƒ¼

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆMSALï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚â”€â”€â”€â”€â”€>â”‚  Streamlit   â”‚â”€â”€â”€â”€â”€>â”‚    MSAL      â”‚â”€â”€â”€â”€â”€>â”‚  Azure AD  â”‚
â”‚          â”‚      â”‚     App      â”‚      â”‚   Library    â”‚      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                     â”‚                     â”‚
                         â”‚  1. Sign In Click   â”‚                     â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
                         â”‚                     â”‚  2. Open Browser    â”‚
                         â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
                         â”‚                     â”‚                     â”‚
                         â”‚                     â”‚  3. User Sign In    â”‚
                         â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚                     â”‚                     â”‚
                         â”‚  4. Access Token    â”‚  4. Return Token    â”‚
                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚                     â”‚                     â”‚
                         â”‚  5. Call Graph API  â”‚                     â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
                         â”‚                                           Graph API
```

### Azureç’°å¢ƒï¼ˆEasy Authï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚â”€â”€â”€â”€â”€>â”‚  Easy Auth   â”‚â”€â”€â”€â”€â”€>â”‚  Streamlit   â”‚â”€â”€â”€â”€â”€>â”‚ Graph API  â”‚
â”‚          â”‚      â”‚  (App Svc)   â”‚      â”‚     App      â”‚      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                     â”‚
                         â”‚  1. HTTP Request    â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
                         â”‚                     â”‚
                         â”‚  2. No Token        â”‚
                         â”‚     Redirect to AD  â”‚
                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚                     â”‚
                         â”‚  3. Sign In         â”‚
                         â”‚  at Azure AD        â”‚
                         â”‚                     â”‚
                         â”‚  4. Token in Header â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
                         â”‚                     â”‚
                         â”‚                     â”‚  5. Call Graph API
                         â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—ã®æµã‚Œ

```
1. User Input
   â†“
   SharePoint Site URL: https://tenant.sharepoint.com/sites/mysite
   Folder Path: Documents/Project
   â†“

2. SharePointClient.get_site_id_by_url()
   â†“
   GET https://graph.microsoft.com/v1.0/sites/tenant.sharepoint.com:/sites/mysite
   â†“
   Response: { "id": "tenant.sharepoint.com,abc123,def456" }
   â†“

3. SharePointClient.list_files()
   â†“
   GET https://graph.microsoft.com/v1.0/sites/{site-id}/drive/root:/Documents/Project:/children
   â†“
   Response: {
     "value": [
       {
         "id": "file-id-1",
         "name": "document.docx",
         "size": 12345,
         "lastModifiedDateTime": "2025-10-30T12:00:00Z",
         "webUrl": "https://..."
       },
       ...
     ]
   }
   â†“

4. Format and Display
   â†“
   ğŸ“„ document.docx
   Size: 12.05 KB
   Modified: 2025-10-30
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1. ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

- **ãƒ­ãƒ¼ã‚«ãƒ«**: Streamlitã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆã«ä¿å­˜
- **Azure**: Easy AuthãŒç®¡ç†ã€HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã§æä¾›
- **æœ‰åŠ¹æœŸé™**: MSALãŒè‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨æ›´æ–°ã‚’ç®¡ç†

### 2. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

```
Azure AD
  â†“ (èªè¨¼)
User Principal
  â†“ (æ¨©é™ãƒã‚§ãƒƒã‚¯)
Graph API
  â†“ (ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯)
SharePoint Site
  â†“ (ã‚µã‚¤ãƒˆæ¨©é™)
Files & Folders
```

### 3. æœ€å°æ¨©é™ã®åŸå‰‡

å¿…è¦ãªæ¨©é™ã®ã¿ã‚’è¦æ±‚ï¼š
- `Sites.Read.All`: SharePointã‚µã‚¤ãƒˆã®èª­ã¿å–ã‚Š
- `Files.Read.All`: ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Azure App Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Azure App Service                 â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       Easy Auth Middleware         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                 â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     Python 3.11 Runtime            â”‚    â”‚
â”‚  â”‚                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚   Streamlit Application      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   (app.py)                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚
â”‚  Environment Variables:                     â”‚
â”‚  - SHAREPOINT_SITE_URL                     â”‚
â”‚  - WEBSITE_AUTH_ENABLED=True               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTPS
         â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Microsoft      â”‚
   â”‚  Graph API      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
GitHub Repository
  â†“
  Push to main branch
  â†“
GitHub Actions
  â†“
  1. Checkout code
  2. Setup Python 3.11
  3. Install dependencies
  4. Deploy to Azure
  â†“
Azure App Service
```

## æ‹¡å¼µæ€§

### è¿½åŠ å¯èƒ½ãªæ©Ÿèƒ½

1. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
   - `SharePointClient.upload_file()`ã‚’è¿½åŠ 
   - Graph API: `PUT /sites/{site-id}/drive/root:/{path}:/content`

2. **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - `SharePointClient.download_file()`ã‚’å®Ÿè£…
   - Streamlitã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 

3. **ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ**
   - `SharePointClient.create_folder()`ã‚’è¿½åŠ 
   - Graph API: `POST /sites/{site-id}/drive/root/children`

4. **ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢æ©Ÿèƒ½**
   - æ—¢å­˜ã®`search_files()`ã‚’æ´»ç”¨
   - UIã«æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

5. **ãƒãƒ«ãƒã‚µã‚¤ãƒˆå¯¾å¿œ**
   - ã‚µã‚¤ãƒˆä¸€è¦§ã‚’å–å¾—
   - ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§ã‚µã‚¤ãƒˆã‚’é¸æŠ

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

1. **ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥**
   - MSALãŒè‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç®¡ç†
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§å†åˆ©ç”¨

2. **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**
   - Graph APIã¯å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆãƒšãƒ¼ã‚¸ãƒ³ã‚°
   - `@odata.nextLink`ã‚’ä½¿ç”¨ã—ã¦æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—

3. **ä¸¦åˆ—å‡¦ç†**
   - è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚’ä¸¦åˆ—åŒ–å¯èƒ½
   - `asyncio`ã‚„`concurrent.futures`ã‚’ä½¿ç”¨

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

å„å±¤ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼š

1. **Graph APIå±¤**
   - HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
   - è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ½å‡º

2. **èªè¨¼å±¤**
   - ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å¤±æ•—
   - æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ

3. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   - ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
